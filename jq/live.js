/*
 * Live preivew through webtun
 *
 * Copyright (c) 2016 dennis @ TME
 */function dashplay(a,b,c){function i(){setTimeout(function(){dashplay(a,b,c)},1e4)}function j(){if(!e&&"open"==h.readyState){e=!0;var a="mp4live.php?phone="+b+"&camera="+c+"&sn="+f;f++;var i=new XMLHttpRequest;i.open("get",a),i.responseType="arraybuffer",g&&i.setRequestHeader("x-mime",1),i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status&&i.response.byteLength>1){var a=i.getResponseHeader("x-dash-mimetype");a&&(d=a,g=0);var b=i.getResponseHeader("x-dash-codecs");b&&(d=d+'; codecs="'+b+'"'),k(i.response)}else e=!1,g=1,setTimeout(j,1e4)},i.send(null)}}function k(b){if("open"==h.readyState){var c;h.sourceBuffers.length>0?c=h.sourceBuffers[0]:(c=h.addSourceBuffer(d),c.mode="sequence",c.onupdateend=function(){if(c.buffered.length>0){var b=c.buffered.start(0),d=a.currentTime-15;d>b&&c.remove(b,d)}},c.onerror=function(a){h.endOfStream()}),a.error||c.updating?i():c.appendBuffer(b),e=!1}}function l(){if("open"==h.readyState&&h.sourceBuffers.length>0&&a.currentTime>=0){var b=h.sourceBuffers[0],c=a.duration-a.currentTime;!b.updating&&!e&&c<3&&!a.paused&&j()}}var d="video/mp4",e=!1,f=0,g=1,h=new MediaSource;h.onsourceopen=function(){j()},a.ontimeupdate=l,a.onerror=i,a.oncanplay=function(){try{a.paused&&(a.play(),a.controls=!1)}catch(b){a.controls=!0}},a.src=URL.createObjectURL(h)}function dashstop(a){a.paused||a.pause(),a.ontimeupdate=null,a.onerror=null,a.src=""}
/*
 * Live preivew through webtun
 *
 * Copyright (c) 2016 dennis @ TME
 */function dashplay(a,b,c){function i(){h.endOfStream(),setTimeout(function(){dashplay(a,b,c)},1e4)}function j(){if(!e&&"open"==h.readyState){e=!0;var a="mp4live.php?phone="+b+"&camera="+c+"&sn="+f;f++;var i=new XMLHttpRequest;i.open("get",a),i.responseType="arraybuffer",g&&i.setRequestHeader("x-mime",1),i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status&&i.response.byteLength>1){var a=i.getResponseHeader("x-dash-mimetype");a&&(d=a,g=0);var b=i.getResponseHeader("x-dash-codecs");b&&(d=d+'; codecs="'+b+'"'),k(i.response)}else e=!1,g=1,setTimeout(j,1e4)},i.send(null)}}function k(b){if("open"==h.readyState){var c;h.sourceBuffers.length>0?c=h.sourceBuffers[0]:(c=h.addSourceBuffer(d),c.mode="sequence",c.onupdateend=function(){e=!1,l()},c.onerror=function(a){h.endOfStream()}),a.error?i():c.appendBuffer(b)}}function l(){if("open"==h.readyState&&h.sourceBuffers.length>0&&a.currentTime>=0){var b=h.sourceBuffers[0],c=a.duration-a.currentTime;if(!b.updating&&!e&&c<2.5&&!a.paused)j();else if(!b.updating&&b.buffered.length>0){var d=b.buffered.start(0),f=a.currentTime-10;f>d&&b.remove(d,f)}}}var d="video/mp4",e=!1,f=0,g=1,h=new MediaSource;h.onsourceopen=function(){j()},a.ontimeupdate=l,a.onerror=i,a.oncanplay=function(){a.play()},a.controls=!1,a.src=URL.createObjectURL(h)}function dashstop(a){a.ontimeupdate=null,a.onerror=null,a.oncanplay=null,a.src=""}